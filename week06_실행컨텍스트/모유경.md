# 실행컨텍스트

## ✏️

### 🔎

<div style="height:100px"></div>

## ✏️ 소스코드의 타입

생성 소스코드의 타입에 따라 실행 컨텍스트를 생성하는 과정과 관리 내용이 다르기때문에 아래 4가지 타입으로 구분하며, 코드가 실행되면 실행 컨텍스트가 생성됨

- 전역코드
  - 전역 변수를 관리하기 위해 최상위 스코프인 전역 스코프를 생성
  - 전역 변수 및 함수 선언문으로 정의된 전역 함수를 전역 객체의 프로퍼티와 메서드로 바인딩 및 참조를 위해 전역객체와 연결되어야 함
- 함수코드
  - 지역스코프를 생성하고 지역변수, 매개변수, arguments객체 관리
  - 생성한 지역스코프를 전역 스코프에서 시작하는 스코프 체인의 일원으로 연결해야함
- eval코드
  - strict mode에서 자신만의 독자적 스코프를 생성
- 모듈코드
  - 모듈 별로 독립적인 모듈 스코프를 생성

## ✏️ 소스코드의 평가와 실행

js engine은 소스코드의 평가, 소스코드의 실행 과정으로 나눠 처리함

1. 전역 코드 평가
2. 전역 코드 실행
3. 함수 코드 평가
4. 함수 코드 실행

### 🔎 소스코드의 평가

- 실행 컨텍스트 생성
- 변수 함수 등의 선언문만 먼저 실행하여 생성된 변수 및 함수 식별자를 키로 실행 컨텍스트가 관리하는 스코프 등록

### 🔎 소스코드의 실행

- 선언문을 제외한 소스코드가 순차적으로 실행되는 런타임이 시작됨
- 소스코드 실행에 필요한 정보에 해당하는 변수 및 함수의 참조는 실행 컨텍스트가 관리하는 스코프에서 검색하여 취득하고 변수 값의 변경 등 소스코드의 실행결과는 실행컨텍스트가 관리하는 스코프에 다시 등록

## ✏️ 실행 컨텍스트

- 소스코드를 실행하는 데 필요한 환경을 제공하고 코드의 실행 결과를 실제로 관리하는 영역
- 식별자를 등록하고 관리하는 스코프와 코드 실행 순서 관리를 구현한 내부 매커니즘으로 모든 코드는 실행 컨텍스트를 통해 실행되고 관리됨
- 식별자와 스코프는 실행 컨텍스트의 렉시컬 환경으로 관리되고 코드 실행 순서는 실행 컨텍스트 스택으로 관리

### 🔎 실행 컨텍스트 스택

코드의 평가 과정에서 생성한 실행 컨텍스트는 stack자료 구조를 통해 관리되고 이를 실행 컨텍스트 스택이라고 함

- 코드를 실행하면, 실행 흐름에 따라서 실행컨텍스트스택에 실행 컨텍스트가 push & pop됨
- 코드의 실행 순서를 관리
- 소스코드가 평가되면 실행 컨텍스트가 생성되고 실행 컨텍스트 스택의 최상위에 쌓이므로 실행컨텍스트 스택의 최상위에 존재하는 실행 컨텍스트는 언제나 실행 중인 실행 컨텍스트임

### 🔎 렉시컬 환경

- 식별자와 식별자에 바인딩 된 값, 그리고 상위 스코프에 대한 참조를 기록하는 자료구조로 실행 컨텍스트를 구성하는 컴포넌트임
- 스코프와 식별자를 관리

실행컨텍스트는 VariableEnvironment컴포넌트로 VariableEnvironment컴포넌트로 구성됨. 생성초기에는 하나의 동일한 렉시컬 환경을 참조하지만, 이후 몇가지 상황을 만나면서 VariableEnvironment컴포넌트를 위한 새로운 렉시컬 환경을 생성하고 이때부터 두 컴포넌트의 내용이 달라질 수 있다.

일반적인 경우로 통일해서 렉시컬 환경을 설명하면, 두 개의 컴포넌트로 구성된다.

1. 환경레코드(EnvironmentRecord)

- 스코프에 포함된 식별자를 등록하고 등록된 식별자에 바인딩 된 값을 관리하는 저장소

2. 외부렉시컬 환경에 대한 참조(OuterLExicalEnvironmentReference)

- 상위스코프를 가리키며, 이는 외부 렉시컬 환경(실행 컨텍스트를 생성한 소스코드를 포함하는 상위 코드의 렉시컬 환경)을 의미
